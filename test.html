<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Map Widget</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,400;0,600;1,400;1,600&display=swap"
      rel="stylesheet"
    >

    <style>
      /* Container holding the map */
      .map-container {
        position: relative;
        width: 1500px;
        height: 1000px;
        margin: 0 auto;
        background: #f0f0f0;
      }

      /* The map image itself */
      .map-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
        border-radius: 10px;
      }

      /* Logbook container â€“ used as both the small icon and the enlarged modal */
      .logbook {
        position: absolute;
        top: 10px;
        right: 10px;
        width: 100px;
        height: 100px;
        cursor: pointer;
        transition: all 0.2s ease;
        z-index: 1100;
        background: none;
      }
      .logbook img {
        width: 100%;
        height: 100%;
        display: block;
      }
      /* Modal state styling for logbook */
      .logbook.modal {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 400px;
        height: auto;
        background: #fff;
        border: 2px solid #ccc;
        border-radius: 10px;
        padding: 20px;
        z-index: 1101;
        text-align: center;
      }
      .logbook.modal h2 {
        margin-top: 0;
      }
      .logbook.modal p {
        font-size: 18px;
      }
      .logbook.modal button {
        margin-top: 20px;
        padding: 10px 20px;
        font-size: 16px;
        border: none;
        border-radius: 8px;
        background-color: #28a745;
        color: #fff;
        cursor: pointer;
        transition: background-color 0.2s;
      }
      .logbook.modal button:hover {
        background-color: #218838;
      }

      /* Overlay to shade the map (hidden by default) */
      .overlay {
        display: none;
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border-radius: 10px;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 900;
      }

      /* Info panel styling */
      .info-panel {
        position: absolute;
        width: 800px;
        min-height: 800px;
        padding: 10px;
        border-radius: 10px;
        background: #fff;
        border: 2px solid #ccc;
        display: none;
        z-index: 1001;
        font-family: 'Poppins', sans-serif;
      }
      /* Arrow styling for non-person pins */
      .info-panel::before {
        content: "";
        position: absolute;
        bottom: -10px;
        left: 20px;
        width: 0;
        height: 0;
        border-left: 10px solid transparent;
        border-right: 10px solid transparent;
        border-top: 10px solid #ccc;
      }
      .info-panel::after {
        content: "";
        position: absolute;
        bottom: -8px;
        left: 20px;
        width: 0;
        height: 0;
        border-left: 8px solid transparent;
        border-right: 8px solid transparent;
        border-top: 8px solid #fff;
      }

      /* Modified styles for the person pin's info panel */
      .info-panel.person-info {
        position: absolute;
        width: 500px;
        min-height: 50px;
        padding: 10px;
        background: #fff;
        border: 2px solid #ccc;
        display: none;
        font-family: 'Poppins', sans-serif;
      }
      /* Arrow for person pin's info panel (pointing left) */
      .info-panel.person-info::before {
        content: "";
        position: absolute;
        top: 20px;
        left: -20px;
        width: 0;
        height: 0;
        border-top: 10px solid transparent;
        border-bottom: 10px solid transparent;
        border-right: 10px solid #fff;
        z-index: 1002;
      }
      .info-panel.person-info::after {
        content: "";
        position: absolute;
        top: 21px;
        left: -8px;
        width: 0;
        height: 0;
        border-top: 8px solid transparent;
        border-bottom: 8px solid transparent;
        border-right: 8px solid #fff;
      }
      /* Hide arrows for non-person info panels */
      .info-panel:not(.person-info)::before,
      .info-panel:not(.person-info)::after {
        display: none;
      }

      /* Pin icon styling */
      .map-pin {
        position: absolute;
        width: 135px;
        height: 135px;
        background: url('pin-icon.png') no-repeat center center / contain;
        cursor: pointer;
        transition: transform 0.2s;
      }
      .person-pin {
        z-index: 1001;
      }
      .map-pin:hover {
        transform: scale(1.1);
      }

      /* Heading styling */
      h1 {
        position: relative;
        text-align: center;
        font-family: 'Poppins', sans-serif;
      }

      /* Responsive Breakpoints for Computer Screens */
      @media (max-width: 1400px) {
        .map-pin {
          width: 120px;
          height: 120px;
        }
        .info-panel,
        .info-panel.person-info {
          width: 450px;
        }
        .map-container {
          width: 1200px;
        }
      }
      @media (max-width: 1200px) {
        .map-pin {
          width: 100px;
          height: 100px;
        }
        .info-panel,
        .info-panel.person-info {
          width: 400px;
        }
        .map-container {
          width: 1000px;
        }
      }
      @media (max-width: 1000px) {
        .map-pin {
          width: 80px;
          height: 80px;
        }
        .info-panel,
        .info-panel.person-info {
          width: 350px;
        }
        .map-container {
          width: 800px;
        }
      }
      @media (max-width: 800px) {
        .map-pin {
          width: 60px;
          height: 60px;
        }
        .info-panel,
        .info-panel.person-info {
          width: 300px;
        }
        .map-container {
          width: 600px;
        }
      }
    </style>
  </head>
  <body>
    <h1>Map Widget</h1>
    <div class="map-container">
      <!-- Map image -->
      <img src="Images/north-america-continent-america-326281.jpg" alt="Map" class="map-image" />

      <!-- Logbook icon / modal -->
      <div class="logbook" id="logbook">
        <img src="/log-and-stamps/logbook.svg" alt="Logbook">
      </div>

      <!-- Overlay for shading -->
      <div class="overlay" id="overlay"></div>

      <!-- Person giving instructions (highlighted) -->
      <img
        src="Images/person-pin.svg"
        class="map-pin person-pin" 
        style="top: 40%; left: 3%;" 
        data-region="Hi there!" 
        data-disasters="Explore the map and click on the pins. Answer a question at each pin to earn a badge on your <b>Resilience Logbook</b>! Click <b>'Begin'</b> to start.">

      <!-- Map pins -->
      <img
        src="map-and-pins/lightning-pin.svg"
        class="map-pin" 
        style="top: 40%; left: 30%;" 
        data-region="Florida" 
        data-disasters="Hurricanes, Tropical Storms">

      <img
        src="map-and-pins/drought-pin.svg"
        class="map-pin" 
        style="top: 55%; left: 55%;" 
        data-region="Droughts" 
        data-disasters="How can we help prevent drought in the Enviorment?"
        data-image="nhi/Drought.png">

      <img
        src="map-and-pins/earthquake-pin.svg"
        class="map-pin" 
        style="top: 55%; left: 21%;" 
        data-region="California" 
        data-disasters="Earthquakes, Wildfires">

      <img
        src="map-and-pins/fire-pin.svg"
        class="map-pin" 
        style="top: 55%; left: 40%;" 
        data-region="California" 
        data-disasters="Earthquakes, Wildfires">

      <img
        src="map-and-pins/volcano-pin.svg"
        class="map-pin" 
        style="top: 45%; left: 35%;" 
        data-region="California" 
        data-disasters="Earthquakes, Wildfires">

      <img
        src="map-and-pins/wind-pin.svg"
        class="map-pin" 
        style="top: 35%; left: 60%;" 
        data-region="California" 
        data-disasters="Earthquakes, Wildfires">

      <img
        src="map-and-pins/flood-pin.svg"
        class="map-pin" 
        style="top: 80%; left: 50%;" 
        data-region="California" 
        data-disasters="Earthquakes, Wildfires">

      <!-- Info panel for displaying pin instructions -->
      <div class="info-panel" id="infoPanel"></div>
    </div>

    <script>
      // Get elements: pins, info panel, overlay, logbook
      const pins = document.querySelectorAll('.map-pin');
      const infoPanel = document.getElementById('infoPanel');
      const overlay = document.getElementById('overlay');
      const logbook = document.getElementById('logbook');

      // Function to update and show the info panel (for map pins)
      function showInfoPanel(pin) {
        const region = pin.getAttribute('data-region');
        const disasters = pin.getAttribute('data-disasters');
        const isPerson = pin.classList.contains('person-pin');
        const hazardImage = pin.getAttribute('data-image');

        // Build the info panel content
        let contentHTML = `<h3>${region}</h3>
          <p>${disasters}</p>`;
        if (hazardImage) {
          contentHTML += `<img src="${hazardImage}" alt="Hazard Image" style="display: block; margin: 20px auto; width: 500px; height: 500px;">`;
        }
        if (isPerson) {
          contentHTML += `<button id="beginButton">Begin</button>`;
          infoPanel.classList.add('person-info');
        } else {
          infoPanel.classList.remove('person-info');
        }
        infoPanel.innerHTML = contentHTML;

        // Show the overlay
        overlay.style.display = 'block';

        // Position the info panel based on pin type
        if (isPerson) {
          const pinTopPercent = parseFloat(pin.style.top);
          const pinLeftPercent = parseFloat(pin.style.left);
          infoPanel.style.top = pinTopPercent + '%';
          infoPanel.style.left = (pinLeftPercent + 10) + '%';
          infoPanel.style.transform = 'none';
        } else {
          infoPanel.style.top = '50%';
          infoPanel.style.left = '50%';
          infoPanel.style.transform = 'translate(-50%, -50%)';
        }
        // Display the info panel
        infoPanel.style.display = 'block';

        // If it's the person pin, attach an event listener to the Begin button.
        if (isPerson) {
          const beginButton = document.getElementById('beginButton');
          beginButton.addEventListener('click', (e) => {
            e.stopPropagation();
            overlay.style.display = 'none';
            infoPanel.style.display = 'none';
          });
        }
      }

      // Add click event listener to all pins
      pins.forEach(pin => {
        pin.addEventListener('click', (event) => {
          event.stopPropagation();
          showInfoPanel(pin);
        });
      });

      // Toggle function for the logbook modal state
      function toggleLogbookModal() {
        if (logbook.classList.contains('modal')) {
          // Revert to icon state
          logbook.classList.remove('modal');
          logbook.innerHTML = '<img src="/log-and-stamps/logbook.svg" alt="Logbook">';
          overlay.style.display = 'none';
        } else {
          // Expand to modal state with placeholder content
          logbook.classList.add('modal');
          logbook.innerHTML = `
            <h2>Your Resilience Logbook</h2>
            <p>You have earned <strong>0 badges</strong> so far.</p>
            <button id="minimizeLogbook">Minimize Logbook</button>
          `;
          overlay.style.display = 'block';
          document.getElementById('minimizeLogbook').addEventListener('click', (e) => {
            e.stopPropagation();
            toggleLogbookModal();
          });
        }
      }

      // Toggle logbook modal when the logbook icon is clicked
      logbook.addEventListener('click', (e) => {
        e.stopPropagation();
        toggleLogbookModal();
      });

      // Clicking the overlay minimizes the logbook modal
      overlay.addEventListener('click', (e) => {
        e.stopPropagation();
        if (logbook.classList.contains('modal')) {
          toggleLogbookModal();
        }
      });

      // Clicking outside minimizes the logbook modal and hides any open info panel
      document.addEventListener('click', (e) => {
        if (!e.target.closest('#logbook') && !e.target.closest('#infoPanel')) {
          if (logbook.classList.contains('modal')) {
            toggleLogbookModal();
          }
          infoPanel.style.display = 'none';
          overlay.style.display = 'none';
        }
      });

      // When the page loads, automatically show the person-pin info panel.
      window.addEventListener('load', () => {
        const personPin = document.querySelector('.person-pin');
        if (personPin) {
          showInfoPanel(personPin);
        }
      });
    </script>
  </body>
</html>