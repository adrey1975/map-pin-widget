<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Map Widget</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,400;0,600;1,400;1,600&display=swap" rel="stylesheet">

    <style>
      body {
        font-family: 'Poppins', sans-serif;
        margin: 0;
        padding: 0;
        background: #cfcfcf83;
      }
      /* Container holding the map */
      .map-container {
        position: relative;
        width: 1670px;
        height: 1200px;
        margin: 0 auto;
        background: #f0f0f0;
      }
      /* The map image itself */
      .map-image {
        width: 100%;
        height: 100%;
        object-fit: contain;
        display: block;
        border-radius: 10px;
      }
      /* Overlay to shade the map (hidden by default) */
      .overlay {
        display: none;
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border-radius: 10px;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 900;
      }
      /* Begin button styling */
      #beginButton {
        display: block;
        margin-left: auto;
        margin-right: 10px;
        border-radius: 10px;
        padding: 10px 20px;
        font-size: 18px;
        background-color: #007bff;
        color: #fff;
        border: none;
        cursor: pointer;
        font-family: 'Poppins', sans-serif;
        transition: background-color 0.2s;
      }
      #beginButton:hover {
        background-color: #0056b3;
      }
      /* Pin icon styling */
      .map-pin {
        position: absolute;
        width: 135px;
        height: 135px;
        background: url('pin-icon.png') no-repeat center center / contain;
        cursor: pointer;
        transition: transform 0.2s;
      }
      /* Responsive person pin styling */
      .person-pin {
        z-index: 1001;
        width: 10vw;
        max-width: 600px;
        height: auto;
      }
      .map-pin:hover {
        transform: scale(1.1);
      }
      /* Info panel styling */
      .info-panel {
        position: absolute;
        width: 1000px;
        min-height: 1000px;
        padding: 10px;
        border-radius: 10px;
        background: #fff;
        border: 2px solid #ccc;
        display: block;
        z-index: 1001;
        font-family: 'Poppins', sans-serif;
      }
      /* Image inside info panel styling */
      .info-panel img, .info-panel .info-panel-image {
        width: 80%;
        display: block;
        height: auto;
        margin: 10px auto;
        border: 2px solid #0056b3;
        border-radius: 10px;
      }
      /* Arrow styling for pins */
      .info-panel::before {
        content: "";
        position: absolute;
        bottom: -10px;
        left: 20px;
        width: 0;
        height: 0;
        border-left: 10px solid transparent;
        border-right: 10px solid transparent;
        border-top: 10px solid #ccc;
      }
      .info-panel::after {
        content: "";
        position: absolute;
        bottom: -8px;
        left: 20px;
        width: 0;
        height: 0;
        border-left: 8px solid transparent;
        border-right: 8px solid transparent;
        border-top: 8px solid #fff;
      }
      /* Modified styles for the person pin's info panel */
      .info-panel.person-info {
        position: absolute;
        width: 30vw;
        max-width: 500px;
        min-height: 50px;
        padding: 10px;
        background: #fff;
        border: 2px solid #ccc;
        display: none;
        font-family: 'Poppins', sans-serif;
      }
      /* Arrow for person pin's info panel (pointing left) */
      .info-panel.person-info::before {
        content: "";
        position: absolute;
        bottom: 20px;
        left: -20px;
        width: 0;
        height: 0;
        border-top: 10px solid transparent;
        border-bottom: 10px solid transparent;
        border-right: 10px solid #fff;
        z-index: 1002;
      }
      .info-panel.person-info::after {
        content: "";
        position: absolute;
        bottom: 18px;
        left: -12px;
        width: 0;
        height: 0;
        border-top: 8px solid transparent;
        border-bottom: 8px solid transparent;
        border-right: 8px solid #ccc;
      }
      /* Hide arrows for the info panels except the npc */
      .info-panel:not(.person-info)::before,
      .info-panel:not(.person-info)::after {
        display: none;
      }
      /* Heading styling */
      h1 {
        position: relative;
        text-align: center;
        font-family: 'Poppins', sans-serif;
      }
      h2 {
        font-size: 2em;
        margin-bottom: 10px;
        position: relative;
        font-family: 'Poppins', sans-serif;
        text-align: center;
      }
      h3 {
        font-size: 1.5em;
        margin-bottom: 10px;
        position: relative;
        font-family: 'Poppins', sans-serif;
      }
      p {
        font-size: 1.3em;
        margin-bottom: 10px;
        position: relative;
        text-align: center;
        font-family: 'Poppins', sans-serif;
      }
      /* Form styling */
      #questionForm {
        display: block;
        margin: 0 auto;
        text-align: center;
      }
      label {
        width: 400px;
        display: inline-block;
        text-align: left;
        font-size: 1.3em;
      }
      .radio-option  {
        margin: 10px 0;
      }
      .radio-option input[type="radio"] {
        margin-right: 10px;
        accent-color: #007bff;
        transform: scale(1.5);
      }
      #submitAnswer {
        display: inline-block;
        margin-top: 10px;
        border-radius: 10px;
        padding: 10px 20px;
        font-size: 18px;
        background-color: #007bff;
        color: #fff;
        border: none;
        cursor: pointer;
        font-family: 'Poppins', sans-serif;
        transition: background-color 0.2s;
      }
      #submitAnswer:hover {
        background-color: #0056b3;
      }
      
      /* Responsive Breakpoints */
      @media (max-width: 1400px) {
        .map-pin {
          max-width: 120px;
        }
        .info-panel,
        .info-panel.person-info {
          max-width: 450px;
        }
        .map-container {
          max-width: 1200px;
        }
        .info-panel img, .info-panel .info-panel-image {
          max-width: 900px;
        }
        #questionForm label {
          width: 400px;
        }
      }
      @media (max-width: 1200px) {
        .map-pin {
          max-width: 100px;
        }
        .info-panel,
        .info-panel.person-info {
          max-width: 400px;
        }
        .map-container {
          max-width: 1000px;
        }
        .info-panel img, .info-panel .info-panel-image {
          max-width: 600px;
        }
        #questionForm label {
          width: 300px;
        }
      }
      @media (max-width: 1000px) {
        .map-pin {
          max-width: 80px;
        }
        .info-panel,
        .info-panel.person-info {
          max-width: 350px;
        }
        .map-container {
          max-width: 800px;
        }
        .info-panel img, .info-panel .info-panel-image {
          max-width: 400px;
        }
        #questionForm label {
          width: 200px;
        }
      }
      @media (max-width: 800px) {
        .map-pin {
          max-width: 60px;
        }
        .info-panel,
        .info-panel.person-info {
          max-width: 300px;
        }
        .map-container {
          max-width: 600px;
        }
        .info-panel img, .info-panel .info-panel-image {
          max-width: 300px;
        }
        #questionForm label {
          width: 150px;
        }
      }
      @media (max-width: 500px) {
        .map-pin {
          max-width: 40px;
        }
        .info-panel,
        .info-panel.person-info {
          max-width: 200px;
        }
        .map-container {
          max-width: 400px;
        }
        .info-panel img, .info-panel .info-panel-image {
          max-width: 200px;
        }
        #questionForm label {
          width: 100px;
        }
      }
    </style>
  </head>
  <body>
    <h1>Map Widget</h1>
    <!-- Map container -->
    <div class="map-container">
      <!-- Map image -->
      <img src="/m-n-pv2/map.svg" alt="Map" class="map-image" />
      <!-- Overlay -->
      <div class="overlay"></div>
      <!-- Person pin -->
      <img
        src="Images/hwcs-character.svg"
        class="map-pin person-pin" 
        style="top: 40%; left: -12%;" 
        data-region="Hi there!" 
        data-disasters="Explore the map and click on the pins. Answer a question at each pin to earn a badge on your <b>Resilience Logbook</b>! Click <b>'Begin'</b> to start.">
      <!-- Other pins -->
      <img
        src="map-and-pins/lightning-pin.svg"
        class="map-pin" 
        style="top: 40%; left: 30%;" 
        data-region="Thunderstorms" 
        data-disasters="Lightning can occur during thunderstorms."
        data-image="nhi/Lightning.png"
        data-question="What should you when there is lightning?"
        data-option1="Stay indoors"
        data-option2="Hide under a tree"
        data-option3="Go swimming">
      <!-- Additional pins omitted for brevity -->
      <!-- Info panel -->
      <div class="info-panel" id="infoPanel"></div>
    </div>
    <!-- JavaScript -->
    <script>
      // Get all pins, the info panel, and the overlay element
      const pins = document.querySelectorAll('.map-pin');
      const infoPanel = document.getElementById('infoPanel');
      const overlay = document.querySelector('.overlay');

      // Function to update and show the info panel
      function showInfoPanel(pin) {
        const region = pin.getAttribute('data-region');
        const disasters = pin.getAttribute('data-disasters');
        const isPerson = pin.classList.contains('person-pin');
        const hazardImage = pin.getAttribute('data-image');
        const question = pin.getAttribute('data-question');
        const option1 = pin.getAttribute('data-option1');
        const option2 = pin.getAttribute('data-option2');
        const option3 = pin.getAttribute('data-option3');

        // Build the info panel content
        let contentHTML = `<h2>${region}</h2>
          <p>${disasters}</p>`;
        if (hazardImage) {
          contentHTML += `<img src="${hazardImage}" alt="Hazard Image" class="info-panel-image" />`;
        }
        if (isPerson) {
          contentHTML += `<button id="beginButton">Begin</button>`;
          infoPanel.classList.add('person-info');
        } else {
          infoPanel.classList.remove('person-info');
        }
        if (question) {
          contentHTML += `<form id="questionForm">
            <h3>${question}</h3>
            <div class="radio-option">
              <input type="radio" name="answer" value="1" id="option1">
              <label for="option1">${option1}</label>
            </div>
            <div class="radio-option">
              <input type="radio" name="answer" value="2" id="option2">
              <label for="option2">${option2}</label>
            </div>
            <div class="radio-option">
              <input type="radio" name="answer" value="3" id="option3">
              <label for="option3">${option3}</label>
            </div>
            <button id="submitAnswer" type="submit">Submit</button>
          </form>`;
        }
        infoPanel.innerHTML = contentHTML;
        overlay.style.display = 'block';

        if (isPerson) {
          // Use getBoundingClientRect to get accurate positions
          const container = document.querySelector('.map-container');
          const containerRect = container.getBoundingClientRect();
          const pinRect = pin.getBoundingClientRect();
          // Position the info panel to the right of the person pin
          const newTop = pinRect.top - containerRect.top;
          const newLeft = pinRect.right - containerRect.left + 20;
          infoPanel.style.top = newTop + 'px';
          infoPanel.style.left = newLeft + 'px';
          infoPanel.style.transform = 'none';
        } else {
          // Center the info panel over the map
          infoPanel.style.top = '50%';
          infoPanel.style.left = '50%';
          infoPanel.style.transform = 'translate(-50%, -50%)';
        }
        infoPanel.style.display = 'block';

        // If it's the person pin, attach event listener to the Begin button
        if (isPerson) {
          const beginButton = document.getElementById('beginButton');
          beginButton.addEventListener('click', (e) => {
            e.stopPropagation();
            overlay.style.display = 'none';
            infoPanel.style.display = 'none';
          });
        }
      }

      // Add click event listener to all pins
      pins.forEach(pin => {
        pin.addEventListener('click', (event) => {
          event.stopPropagation();
          showInfoPanel(pin);
        });
      });

      // Hide the info panel and overlay if user clicks outside
      document.addEventListener('click', (event) => {
        if (!event.target.closest('.map-pin') && !event.target.closest('#infoPanel')) {
          infoPanel.style.display = 'none';
          overlay.style.display = 'none';
        }
      });

      // Reposition the person info panel on window resize if visible
      window.addEventListener('resize', () => {
        const personPin = document.querySelector('.person-pin');
        if (personPin && infoPanel.classList.contains('person-info') && infoPanel.style.display === 'block') {
          showInfoPanel(personPin);
        }
      });

      // On page load, show the person pin's info panel
      window.addEventListener('load', () => {
        const personPin = document.querySelector('.person-pin');
        if (personPin) {
          showInfoPanel(personPin);
        }
      });
    </script>
  </body>
</html>